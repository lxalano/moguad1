!function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}__webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{configurable:!1,enumerable:!0,get:getter})},__webpack_require__.r=function(exports){Object.defineProperty(exports,"__esModule",{value:!0})},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function(){return module.default}:function(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="/",__webpack_require__(__webpack_require__.s=0)}([function(module,exports,__webpack_require__){"use strict";var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)Object.hasOwnProperty.call(mod,k)&&(result[k]=mod[k]);return result.default=mod,result},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var config_1=__webpack_require__(1),message=__importStar(__webpack_require__(2)),proxy_1=__webpack_require__(5),local_event_bus_1=__webpack_require__(6),local_sdk_events_1=__importDefault(__webpack_require__(9)),logger_1=__webpack_require__(3),sdk_database_1=__importDefault(__webpack_require__(10));logger_1.Log.name="ISDK",config_1.IS_DEV&&(logger_1.Log.level=logger_1.LogLevel.Debug,logger_1.Log.enableModule("*"),logger_1.Log.disableModule("local-bus"));proxy_1.SDKProxy("iframe",function(conf){return(new sdk_database_1.default).setup(conf)}).then(function(){local_event_bus_1.LocalEventBus.subscribe(local_sdk_events_1.default.All,function(detail,evt){message.postAndForget("iframe",window.parent,"event",[evt.code,detail,evt.consumed])})})},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"SDK_API_LVL",function(){return SDK_API_LVL}),__webpack_require__.d(__webpack_exports__,"SDK_VERSION",function(){return SDK_VERSION}),__webpack_require__.d(__webpack_exports__,"SDK_MAJOR_VERSION",function(){return SDK_MAJOR_VERSION}),__webpack_require__.d(__webpack_exports__,"SDK_DISMISS_NOTIF_AFTER",function(){return SDK_DISMISS_NOTIF_AFTER}),__webpack_require__.d(__webpack_exports__,"RETRY_MAX_ATTEMPTS",function(){return RETRY_MAX_ATTEMPTS}),__webpack_require__.d(__webpack_exports__,"RETRY_MIN_INTERVAL_MS",function(){return RETRY_MIN_INTERVAL_MS}),__webpack_require__.d(__webpack_exports__,"SSL_SCRIPT_URL",function(){return SSL_SCRIPT_URL}),__webpack_require__.d(__webpack_exports__,"WS_URL",function(){return WS_URL}),__webpack_require__.d(__webpack_exports__,"IS_DEV",function(){return IS_DEV}),__webpack_require__.d(__webpack_exports__,"IS_TEST",function(){return IS_TEST});var SDK_API_LVL=1,SDK_VERSION="2.1.0",SDK_MAJOR_VERSION="2",SDK_DISMISS_NOTIF_AFTER=30,RETRY_MAX_ATTEMPTS=3,RETRY_MIN_INTERVAL_MS=1e3,SSL_SCRIPT_URL="via.batch.com",WS_URL="https://ws.batch.com/web",IS_DEV=!1,IS_TEST=!1},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var logger_1=__webpack_require__(3);exports.extractBatch=function(e){return e&&e.data&&e.data.batch?e.data.batch:null},exports.request=function(from,msg,args){return{batch:{from:from,msg:msg,args:args||[]}}},exports.successResponse=function(from,msg,result){return{batch:{from:from,msg:msg,success:!0,result:result}}},exports.errorResponse=function(from,msg,error){return{batch:{error:(error||"Unknwon Error").toString(),from:from,msg:msg,success:!1}}},exports.post=function(from,to,msg,args){return new Promise(function(resolve,reject){var channel=new MessageChannel;channel.port1.onmessage=function(e){var batch=exports.extractBatch(e);batch?batch.success?resolve(batch.result):reject(batch.error):(logger_1.Log.warn("message","("+from+")","invalid response",e),reject("Invalid response"))},to.postMessage(exports.request(from,msg,args),"*",[channel.port2])})},exports.listen=function(from,listener){return window.addEventListener("message",function(e){var batch=exports.extractBatch(e);null!=batch&&batch.from===from&&(logger_1.Log.debug("message","("+from+")","recieved",batch),listener(batch,e))})},exports.postAndForget=function(from,to,msg,args){return to.postMessage(exports.request(from,msg,args),"*")}},function(module,exports,__webpack_require__){"use strict";var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)Object.hasOwnProperty.call(mod,k)&&(result[k]=mod[k]);return result.default=mod,result},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var LogLevel,config_1=__webpack_require__(1),message=__importStar(__webpack_require__(2)),window_1=__importDefault(__webpack_require__(4));!function(LogLevel){LogLevel[LogLevel.None=0]="None",LogLevel[LogLevel.Public=1]="Public",LogLevel[LogLevel.Error=2]="Error",LogLevel[LogLevel.Warn=3]="Warn",LogLevel[LogLevel.Info=4]="Info",LogLevel[LogLevel.Trace=5]="Trace",LogLevel[LogLevel.Debug=6]="Debug"}(LogLevel=exports.LogLevel||(exports.LogLevel={}));var publicModuleName="public",instance=new(function(){function Logger(){this.level=LogLevel.Public,this.enabledModules=new Set,this.disabledModules=new Set,this.name="SDK",this.enabledModules.add(publicModuleName),this.loadStorageSettings(),config_1.IS_DEV&&this.addGlobalEventListeners()}return Logger.prototype.loadStorageSettings=function(){var _this=this,safeWindow=window_1.default();if(null!=safeWindow&&"object"==typeof safeWindow.localStorage){"1"===safeWindow.localStorage.getItem("com.batch.private.logger.listeners")&&this.addGlobalEventListeners();var rawLevel=safeWindow.localStorage.getItem("com.batch.private.logger.level");if(null!=rawLevel){var level=+rawLevel;level>=0&&level<=6&&(this.level=level)}try{var rawEnabledModules=safeWindow.localStorage.getItem("com.batch.private.logger.modules.enabled");if(rawEnabledModules){var enabledModules=JSON.parse(rawEnabledModules);Array.isArray(enabledModules)&&enabledModules.forEach(function(m){_this.enableModule(m)})}var rawDisabledModules=safeWindow.localStorage.getItem("com.batch.private.logger.modules.disabled");if(rawDisabledModules){var disabledModules=JSON.parse(rawDisabledModules);Array.isArray(disabledModules)&&disabledModules.forEach(function(m){_this.disableModule(m)})}}catch(_){}}},Logger.prototype.addGlobalEventListeners=function(){var _this=this,safeWindow=window_1.default();null!=safeWindow&&(safeWindow.addEventListener("___batchSDK___.logger.enableModule",function(e){return _this.enableModule(e.module)}),safeWindow.addEventListener("___batchSDK___.logger.disableModule",function(e){return _this.disableModule(e.module)}),safeWindow.addEventListener("___batchSDK___.logger.setLogLevel",function(e){var levelValue;switch(e.level.toLowerCase()){case"none":levelValue=0;break;case"error":levelValue=1;break;case"warn":levelValue=2;break;case"info":levelValue=3;break;case"trace":levelValue=4;break;case"debug":default:levelValue=5}_this.level=levelValue}))},Logger.prototype.enableModule=function(module){this.enabledModules.add(module.toLowerCase())},Logger.prototype.enableTunneling=function(to){this.tunnelingTo=to},Logger.prototype.disableModule=function(module){this.disabledModules.add(module.toLowerCase())},Logger.prototype.isModuleEnabled=function(module){var m=module.toLowerCase();return!this.disabledModules.has(m)&&(this.enabledModules.has("*")||this.enabledModules.has(m))},Logger.prototype.shouldLogForLevel=function(wantedLevel){return this.level>0&&wantedLevel<=this.level},Logger.prototype.logMethodForLevel=function(wantedLevel){var method;switch(wantedLevel){case LogLevel.Public:method=console.log;break;case LogLevel.Error:method=console.error;break;case LogLevel.Info:method=console.info;break;case LogLevel.Warn:method=console.warn;break;case LogLevel.Trace:method=console.trace;break;case LogLevel.Debug:default:method=console.debug}return method||console.log},Logger.prototype.getGroupMethod=function(end){return void 0===end&&(end=!1),end?console.groupEnd:console.group},Logger.prototype.formatPrefix=function(moduleName){return moduleName===publicModuleName?"Batch":"Batch "+this.name+" ["+moduleName+"]"},Logger.prototype.public=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];this.log.apply(this,[LogLevel.Public,publicModuleName].concat(args))},Logger.prototype.error=function(module){for(var args=[],_i=1;_i<arguments.length;_i++)args[_i-1]=arguments[_i];this.log.apply(this,[LogLevel.Error,module].concat(args))},Logger.prototype.warn=function(module){for(var args=[],_i=1;_i<arguments.length;_i++)args[_i-1]=arguments[_i];this.log.apply(this,[LogLevel.Warn,module].concat(args))},Logger.prototype.info=function(module){for(var args=[],_i=1;_i<arguments.length;_i++)args[_i-1]=arguments[_i];this.log.apply(this,[LogLevel.Info,module].concat(args))},Logger.prototype.trace=function(module){for(var args=[],_i=1;_i<arguments.length;_i++)args[_i-1]=arguments[_i];this.log.apply(this,[LogLevel.Trace,module].concat(args))},Logger.prototype.debug=function(module){for(var args=[],_i=1;_i<arguments.length;_i++)args[_i-1]=arguments[_i];this.log.apply(this,[LogLevel.Debug,module].concat(args))},Logger.prototype.log=function(level,moduleName){for(var args=[],_i=2;_i<arguments.length;_i++)args[_i-2]=arguments[_i];if(this.tunnelingTo){var a_1=[];args.forEach(function(v){switch(typeof v){case"number":case"string":case"boolean":a_1.push(v);break;case"object":try{a_1.push(v?"["+v.toString()+"]":null)}catch(e){a_1.push("[No toString method]")}break;default:a_1.push("[Unsupported type "+typeof v+"]")}}),message.postAndForget(this.name,this.tunnelingTo,"log",[level,this.name+":"+moduleName].concat(a_1))}level===LogLevel.Public&&(moduleName=publicModuleName),this.isModuleEnabled(moduleName)&&this.shouldLogForLevel(level)&&this.logMethodForLevel(level).apply(console,[this.formatPrefix(moduleName),"-"].concat(args))},Logger.prototype.grouped=function(level,module,groupTitle,lines){if(this.isModuleEnabled(module)&&this.shouldLogForLevel(level)){groupTitle?this.getGroupMethod().apply(console,[this.formatPrefix(module),"-",groupTitle]):this.getGroupMethod().apply(console,[this.formatPrefix(module)]);var logMethod_1=this.logMethodForLevel(level);lines.forEach(function(l){return logMethod_1.apply(console,[l])}),this.getGroupMethod(!0).apply(console,[])}},Logger}()),safeWindow=window_1.default();null!=safeWindow&&safeWindow.addEventListener("message",function(e){var batch=message.extractBatch(e);null!=batch&&"log"===batch.msg&&batch.args&&instance.log.apply(instance,batch.args)}),exports.Log=instance},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=function(){return"object"==typeof window?window:null}},function(module,exports,__webpack_require__){"use strict";var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)Object.hasOwnProperty.call(mod,k)&&(result[k]=mod[k]);return result.default=mod,result};Object.defineProperty(exports,"__esModule",{value:!0});var logger_1=__webpack_require__(3),message=__importStar(__webpack_require__(2)),instance=null;exports.DOMReady=new Promise(function(resolve){"complete"===document.readyState||"loaded"===document.readyState||"interactive"===document.readyState?resolve():window.addEventListener("DOMContentLoaded",function(){resolve()})}),exports.SDKProxy=function(name,initSDK){return new Promise(function(resolve,reject){window.addEventListener("message",function(e){var batch=message.extractBatch(e);if(null!=batch){logger_1.Log.debug("proxy","message",batch);var port=e.ports[0];("setup"===batch.msg?exports.DOMReady.then(function(){return null!=instance?Promise.reject("already initialized"):((instance=initSDK(batch.args[0])).then(resolve,reject),instance.then(function(){return!0}))}):exports.DOMReady.then(function(){return name=batch.msg,args=batch.args,null==instance?Promise.reject("Not intialized"):instance.then(function(sdk){return sdk[name]?sdk[name].apply(sdk,args):Promise.reject("unkown message "+name)});var name,args})).then(function(r){logger_1.Log.debug("proxy","result",r),null!=port&&port.postMessage(message.successResponse(name,batch.msg,r))}).catch(function(err){logger_1.Log.warn("proxy","error",err),null!=port&&port.postMessage(message.errorResponse(name,batch.msg,err))})}})})}},function(module,exports,__webpack_require__){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var bounded_queue_1=__importDefault(__webpack_require__(7)),deep_obj_compare_1=__importDefault(__webpack_require__(8)),local_sdk_events_1=__importDefault(__webpack_require__(9)),logger_1=__webpack_require__(3),Evt=function(){return function(code,detail,consumed){this.code=code,this.detail=detail,this.consumed=consumed}}();exports.Evt=Evt;var EventBus=function(){function EventBus(){this.listeners=new Map,this.passedEvents=new Map}return EventBus.prototype.subscribe=function(evt,listener){if("function"!=typeof listener||"string"!=typeof evt)throw new Error("wrong parameters");this.getListenersFor(evt).push(listener),logger_1.Log.grouped(logger_1.LogLevel.Info,"local-bus","new listener subscribed",["to: "+evt,listener]),this.emitMissedEvents(evt,listener)},EventBus.prototype.emit=function(code,detail,consumed){if(code!==local_sdk_events_1.default.All){var evt=new Evt(code,detail||{},consumed),passed=this.getPassedEventsFor(code),last=passed.peek();consumed&&(passed.clear(),passed.push(evt)),deep_obj_compare_1.default(last,evt)?logger_1.Log.debug("local-bus","skipped",evt):(consumed||passed.push(evt),logger_1.Log.debug("local-bus","emit",evt),(this.listeners.get(code)||[]).forEach(function(e){return e(evt.detail,evt)}),(this.listeners.get(local_sdk_events_1.default.All)||[]).forEach(function(e){return e(evt.detail,evt)}))}else logger_1.Log.warn("local-bus","The event * can't be triggered")},EventBus.prototype.getListenersFor=function(evt){var listeners=this.listeners.get(evt);return listeners||(listeners=[],this.listeners.set(evt,listeners)),listeners},EventBus.prototype.emitMissedEvents=function(code,listener){var _this=this;code===local_sdk_events_1.default.All?this.passedEvents.forEach(function(value,key){return _this.emitMissedEvents(key,listener)}):this.passedEvents.has(code)&&this.getPassedEventsFor(code).forEach(function(evt){return listener(evt.detail,evt)})},EventBus.prototype.getPassedEventsFor=function(code){var events=this.passedEvents.get(code);return null==events&&(events=new bounded_queue_1.default(10),this.passedEvents.set(code,events)),events},EventBus}();exports.EventBus=EventBus,exports.LocalEventBus=new EventBus},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var BoundedQueue=function(){function BoundedQueue(capacity){if(this.backingArray=[],this.capacity=capacity,capacity<=0)throw new Error("Capacity must be greater than zero")}return BoundedQueue.prototype.enforceCapacity=function(){for(;this.backingArray.length>this.capacity;)this.backingArray.shift()},BoundedQueue.prototype.push=function(value){this.backingArray.push(value),this.enforceCapacity()},BoundedQueue.prototype.peek=function(){return 0===this.backingArray.length?null:this.backingArray[this.backingArray.length-1]},BoundedQueue.prototype.pop=function(){return 0===this.backingArray.length?null:this.backingArray.pop()},BoundedQueue.prototype.clear=function(){this.backingArray.length=0},BoundedQueue.prototype.forEach=function(method,thisArg){this.backingArray.forEach(method)},BoundedQueue.prototype.values=function(){return this.backingArray},BoundedQueue}();exports.default=BoundedQueue},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var isNull=value=>null===value||void 0===value,isBuffer=value=>!(!value||"object"!=typeof value||"number"!=typeof value.length)&&("function"==typeof value.copy&&"function"==typeof value.slice&&!(value.length>0&&"number"!=typeof value[0])),deepEqual=(actual,expected)=>{if(actual===expected)return!0;if(actual instanceof Date&&expected instanceof Date)return actual.getTime()===expected.getTime();if(!actual||!expected||"object"!=typeof actual&&"object"!=typeof expected)return actual===expected;if(isNull(actual)||isNull(expected))return!1;if(actual.prototype!==expected.prototype)return!1;if(isBuffer(actual)){if(!isBuffer(expected)||actual.length!==expected.length)return!1;for(var i=0;i<actual.length;i++)if(actual[i]!==expected[i])return!1;return!0}if(typeof actual!=typeof expected)return!1;var ka,kb;try{ka=Object.keys(actual),kb=Object.keys(expected)}catch(e){return!1}if(ka.length!==kb.length)return!1;for(var _i=ka.length-1;_i>=0;_i--)if(ka[_i]!==kb[_i])return!1;for(var _i2=ka.length-1;_i2>=0;_i2--){var key=ka[_i2];if(!deepEqual(actual[key],expected[key]))return!1}return!0};__webpack_exports__.default=deepEqual},function(module,exports,__webpack_require__){"use strict";var LocalSDKEvent;Object.defineProperty(exports,"__esModule",{value:!0}),function(LocalSDKEvent){LocalSDKEvent.All="*",LocalSDKEvent.ProfileChanged="profileChanged",LocalSDKEvent.SubscriptionChanged="subscriptionChanged",LocalSDKEvent.UiComponentReady="uiComponentReady",LocalSDKEvent.UiComponentDrawn="uiComponentDrawn",LocalSDKEvent.UiReady="uiReady"}(LocalSDKEvent||(LocalSDKEvent={})),exports.default=LocalSDKEvent},function(module,exports,__webpack_require__){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=this&&this.__generator||function(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=y[2&op[0]?"return":op[0]?"throw":"next"])&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[0,t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var event_1=__importDefault(__webpack_require__(11)),event_names_1=__webpack_require__(13),event_tracker_1=__importDefault(__webpack_require__(14)),user_agent_1=__webpack_require__(20),uuid_1=__importDefault(__webpack_require__(12)),window_1=__importDefault(__webpack_require__(4)),local_event_bus_1=__webpack_require__(6),local_sdk_events_1=__importDefault(__webpack_require__(9)),logger_1=__webpack_require__(3),keys_1=__webpack_require__(21),parameter_store_1=__importDefault(__webpack_require__(23)),executor_1=__importDefault(__webpack_require__(30)),sdk_1=__webpack_require__(31),safeWindow=window_1.default(),DatabaseSDK=function(){function DatabaseSDK(){}return DatabaseSDK.prototype.setup=function(sdkConfig){var _this=this;return this.config=Object.assign({},sdkConfig),new Promise(function(resolve,reject){if(_this.config.apiKey)if(_this.config.subdomain)if(_this.config.authKey){"boolean"!=typeof _this.config.dev&&(_this.config.dev=!1);var storePromise=parameter_store_1.default.getInstance().then(function(ps){return _this.parameterStore=ps,ps});storePromise.then(function(ps){return ps.setParameterValue(keys_1.keysByProvider.profile.LastConfiguration,_this.config)});var referrer,idPromise=storePromise.then(function(ps){return ps.getParameterValue(keys_1.keysByProvider.profile.InstallationID)}).then(function(i){return null==i?_this.createInstallationID():Promise.resolve(i)}).catch(function(){return _this.createInstallationID()}),defPromise=storePromise.then(function(ps){var stPromise=ps.getParameterValue(keys_1.keysByProvider.profile.Subscription).then(function(s){return _this.lastSubscription=s}),sdPromise=ps.getParameterValue(keys_1.keysByProvider.profile.Subscribed).then(function(s){return _this.lastSubscribed=!0===s});return Promise.all([stPromise,sdPromise]).then(function(){return _this.readPermission().then(function(p){return _this.lastPermission=p}).then(function(){return _this.lastState={permission:_this.lastPermission||sdk_1.Permission.Default,subscribed:_this.lastSubscribed||!1}})})});_this.config.internal&&_this.config.internal.referrer&&(referrer=_this.config.internal.referrer);var wsPromise=storePromise.then(function(ps){return _this.webserviceExecutor=new executor_1.default(_this.config.apiKey,_this.config.subdomain,_this.config.authKey,_this.config.dev,referrer,ps),_this.eventTracker=new event_tracker_1.default(_this.webserviceExecutor),_this.eventTracker}),isNewPromise=storePromise.then(function(){return _this.isNewSession()});Promise.all([isNewPromise,wsPromise,defPromise]).then(function(r){var isNew=r[0],eventTracker=r[1];isNew&&(eventTracker.track(new event_1.default(event_names_1.InternalSDKEvent.Start,{token:_this.getEventToken()})),logger_1.Log.info("sdk-database","New session : "+event_names_1.InternalSDKEvent.Start+" sent","with sub",_this.lastSubscription))}),Promise.all([wsPromise,defPromise]).then(function(){return null!=safeWindow&&void 0!==safeWindow.navigator&&"permissions"in safeWindow.navigator?safeWindow.navigator.permissions.query({name:"notifications"}).then(function(d){return d.addEventListener("change",_this.checkUpdate.bind(_this))}):Promise.reject(new Error("Permissions object is not available"))}).catch(function(e){return logger_1.Log.warn("sdk-database","Error while listening to permssion changes (not a fatal error)",e)}),Promise.all([wsPromise,defPromise]).then(function(){null!=safeWindow&&(new user_agent_1.UserAgent(safeWindow.navigator.userAgent).browser===user_agent_1.Browser.Firefox&&safeWindow.setInterval(_this.checkUpdate.bind(_this),5e3),safeWindow.addEventListener("focus",_this.checkUpdate.bind(_this)))}),Promise.all([storePromise,wsPromise,idPromise,defPromise]).then(function(){return resolve(_this)}).catch(function(e){logger_1.Log.error("sdk-database","Error while initializing the sdk",e),reject(new Error("Error while initializing the sdk"))})}else reject(new Error("Configuration error: 'authKey' is mandatory"));else reject(new Error("Configuration error: 'subdomain' is mandatory"));else reject(new Error("Configuration error: 'apiKey' is mandatory"))})},DatabaseSDK.prototype.isNewSession=function(){return this.getParameterStore().then(function(store){return store.getParameterValue(keys_1.keysByProvider.session.SessionID).then(function(sessid){return null===sessid?store.setParameterValue(keys_1.keysByProvider.session.SessionID,uuid_1.default()).then(function(){return Promise.resolve(!0)}):Promise.resolve(!1)})})},DatabaseSDK.prototype.getParameterStore=function(){return null!=this.parameterStore?Promise.resolve(this.parameterStore):Promise.reject("parameter store null")},DatabaseSDK.prototype.createInstallationID=function(){return this.getParameterStore().then(function(p){return p.setParameterValue(keys_1.keysByProvider.profile.InstallationID,uuid_1.default())})},DatabaseSDK.prototype.bumpProfileVersion=function(){return this.getParameterStore().then(function(p){return p.getParameterValue(keys_1.keysByProvider.profile.UserProfileVersion).then(function(version){var intVal=parseInt(version,10);return p.setParameterValue(keys_1.keysByProvider.profile.UserProfileVersion,isNaN(intVal)?0:intVal+1)})}).then(function(){return!0})},DatabaseSDK.prototype.setProfileParameter=function(key,identifier){var _this=this;return this.getParameterStore().then(function(p){return p.setParameterValueIfChanged(key,identifier)}).then(function(idChanged){return idChanged&&_this.bumpProfileVersion().then(function(){var _a;_this.eventTracker&&_this.eventTracker.track(new event_1.default(event_names_1.InternalSDKEvent.ProfileChanged)),local_event_bus_1.LocalEventBus.emit(local_sdk_events_1.default.ProfileChanged,((_a={})[key]=identifier,_a),!0)}),identifier})},DatabaseSDK.prototype.setCustomUserID=function(identifier){return this.setProfileParameter(keys_1.keysByProvider.profile.CustomIdentifier,identifier)},DatabaseSDK.prototype.setLanguage=function(lang){return this.setProfileParameter(keys_1.keysByProvider.profile.UserLanguage,lang)},DatabaseSDK.prototype.setRegion=function(lang){return this.setProfileParameter(keys_1.keysByProvider.profile.UserRegion,lang)},DatabaseSDK.prototype.getCustomUserID=function(){return this.getParameterStore().then(function(p){return p.getParameterValue(keys_1.keysByProvider.profile.CustomIdentifier)})},DatabaseSDK.prototype.getLanguage=function(){return this.getParameterStore().then(function(p){return p.getParameterValue(keys_1.keysByProvider.profile.UserLanguage)})},DatabaseSDK.prototype.getRegion=function(){return this.getParameterStore().then(function(p){return p.getParameterValue(keys_1.keysByProvider.profile.UserRegion)})},DatabaseSDK.prototype.getInstallationID=function(){return this.getParameterStore().then(function(s){return s.getParameterValue(keys_1.keysByProvider.profile.InstallationID)}).then(function(i){return null!=i?Promise.resolve(i):Promise.reject("Invalid internal state")})},DatabaseSDK.prototype.isSubscribed=function(){var _this=this;return this.getPermission().then(function(p){return"granted"===p}).then(function(b){return b&&_this.readAndCheckSubscribed()}).then(function(b){return b&&_this.getSubscription().then(function(sub){return null!=sub})})},DatabaseSDK.prototype.getPermission=function(){var _this=this;return this.readPermission().then(function(perm){return _this.updatePermission(perm)})},DatabaseSDK.prototype.readPermission=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.getSubscription()];case 1:return _a.sent()?[2,sdk_1.Permission.Granted]:[2,sdk_1.Permission.Default]}})})},DatabaseSDK.prototype.subscribe=function(){var _this=this;return this.getPermission().then(function(perm){return"granted"===perm?_this.updateSubscribed(!0):Promise.reject("Permission denied")}).then(function(){return _this.isSubscribed()})},DatabaseSDK.prototype.unsubscribe=function(){var _this=this;return this.updateSubscribed(!1).then(function(){return _this.isSubscribed()}).then(function(subscribed){return!subscribed})},DatabaseSDK.prototype.getSubscription=function(){return this.readAndCheckSubscription()},DatabaseSDK.prototype.getSubscriptionState=function(){return __awaiter(this,void 0,void 0,function(){var _a;return __generator(this,function(_b){switch(_b.label){case 0:return _a={},[4,this.getPermission()];case 1:return _a.permission=_b.sent(),[4,this.isSubscribed()];case 2:return[2,(_a.subscribed=_b.sent(),_a)]}})})},DatabaseSDK.prototype.checkUpdate=function(){return this.getSubscriptionState().then(function(){return Promise.resolve()})},DatabaseSDK.prototype.readAndCheckSubscribed=function(){var _this=this;return this.getParameterStore().then(function(p){return p.getParameterValue(keys_1.keysByProvider.profile.Subscribed)}).then(function(sub){return!0===sub}).then(function(sub){return _this.lastSubscribed!==sub&&(logger_1.Log.info("sdk-database","Subscribed updated",sub),_this.lastSubscribed=sub,_this.subscriptionChanged(!0)),Promise.resolve(sub)})},DatabaseSDK.prototype.readAndCheckSubscription=function(){var _this=this;return this.getParameterStore().then(function(p){return p.getParameterValue(keys_1.keysByProvider.profile.Subscription)}).then(function(sub){var last=_this.lastSubscription;return(null==last&&null!=sub||null!=last&&null==sub||null!=last&&last.endpoint!==sub.endpoint)&&(logger_1.Log.info("sdk-database","Subscription updated",sub),_this.lastSubscription=sub,_this.subscriptionChanged(!0)),Promise.resolve(sub)})},DatabaseSDK.prototype.updateSubscribed=function(subscribed){var _this=this;return this.getParameterStore().then(function(p){return p.setParameterValue(keys_1.keysByProvider.profile.Subscribed,subscribed)}).then(function(){return _this.readAndCheckSubscribed()})},DatabaseSDK.prototype.updateSubscription=function(sub){var _this=this;return this.getParameterStore().then(function(p){return p.setParameterValue(keys_1.keysByProvider.profile.Subscription,sub)}).then(function(){return _this.readAndCheckSubscription()})},DatabaseSDK.prototype.updatePermission=function(perm){return this.lastPermission!==perm&&(this.lastPermission=perm,this.subscriptionChanged(!1)),Promise.resolve(perm)},DatabaseSDK.prototype.subscriptionChanged=function(tokenChanged){var _this=this;return void 0===tokenChanged&&(tokenChanged=!1),this.getSubscriptionState().then(function(state){return __awaiter(_this,void 0,void 0,function(){var params;return __generator(this,function(_a){switch(_a.label){case 0:return!tokenChanged&&this.lastState&&this.lastState.subscribed===state.subscribed?[3,3]:this.eventTracker?(params={token:this.getEventToken()},this.config.internal&&this.config.internal.referrer&&(params.referrer=this.config.internal.referrer),this.eventTracker.track(new event_1.default(state.subscribed?event_names_1.InternalSDKEvent.Subscribed:event_names_1.InternalSDKEvent.Unsubscribed,params)),[4,this.getParameterStore()]):[3,3];case 1:return[4,_a.sent().setParameterValue(keys_1.keysByProvider.profile.Subscribed,state.subscribed)];case 2:_a.sent(),_a.label=3;case 3:return this.lastState=state,local_event_bus_1.LocalEventBus.emit(local_sdk_events_1.default.SubscriptionChanged,state,!0),[2]}})})})},DatabaseSDK.prototype.getEventToken=function(){return this.lastSubscription?{protocol:"WPP",subscription:this.lastSubscription}:null},DatabaseSDK}();exports.default=DatabaseSDK},function(module,exports,__webpack_require__){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var uuid_1=__importDefault(__webpack_require__(12)),Event=function(){return function(name,params){if("string"!=typeof name)throw new Error("Error while constructing Event: 'name' is required and should be a string");if(this.id=uuid_1.default(),this.name=name.toUpperCase(),this.date=new Date,null!=params&&"object"!=typeof params)throw new Error("Error while constructing Event: 'params' is optional but must be an object if provided");this.params=params||{}}}();exports.default=Event},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var supportsPRNG=void 0!==self.crypto&&void 0!==self.crypto.getRandomValues;exports.default=function(){var randomNumbers=new Array(31);if(supportsPRNG){var prngRandomBytes=new Uint8Array(randomNumbers.length);self.crypto.getRandomValues(prngRandomBytes);for(var i=0;i<randomNumbers.length;i+=1)randomNumbers[i]=prngRandomBytes[i]%16|0}else for(i=0;i<randomNumbers.length;i+=1)randomNumbers[i]=16*Math.random()|0;randomNumbers[15]=3&randomNumbers[15]|8;var uuidString="";for(i=0;i<randomNumbers.length;i+=1)uuidString+=randomNumbers[i].toString(16),7===i||14===i||18===i?uuidString+="-":11===i&&(uuidString+="-4");return uuidString}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),function(InternalSDKEvent){InternalSDKEvent.ProfileChanged="_PROFILE_CHANGED",InternalSDKEvent.Start="_START",InternalSDKEvent.Subscribed="_SUBSCRIPTION",InternalSDKEvent.Unsubscribed="_UNSUBSCRIPTION",InternalSDKEvent.PushOpen="_OPEN_PUSH"}(exports.InternalSDKEvent||(exports.InternalSDKEvent={}))},function(module,exports,__webpack_require__){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var config_1=__webpack_require__(1),timed_promise_1=__webpack_require__(15),event_tracker_1=__importDefault(__webpack_require__(16)),EventTracker=function(){function EventTracker(webserviceExecutor){this.buffer=[],this.webserviceExecutor=webserviceExecutor,this.attemptRunning=!1}return EventTracker.prototype.track=function(event){var _this=this;this.buffer.push(event),this.debounceSend&&clearTimeout(this.debounceSend),this.debounceSend=self.setTimeout(function(){_this.send()},0)},EventTracker.prototype.send=function(retryCount){var _this=this;return void 0===retryCount&&(retryCount=0),!(0===retryCount&&this.attemptRunning||0===this.buffer.length)&&(this.attemptRunning=!0,this.webserviceExecutor.start(new event_tracker_1.default(this.buffer)).then(function(){_this.attemptRunning=!1,_this.buffer=[],_this.send()}).catch(function(){(retryCount+=1)<config_1.RETRY_MAX_ATTEMPTS?timed_promise_1.Delay(config_1.RETRY_MIN_INTERVAL_MS).then(function(){_this.send(retryCount)}):_this.attemptRunning=!1}),!0)},EventTracker}();exports.default=EventTracker},function(module,exports,__webpack_require__){"use strict";function Delay(duration){return new Promise(function(resolve){return setTimeout(resolve,duration)})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Delay=Delay,exports.Timeout=function(duration){return Delay(duration).then(function(){return Promise.reject("Timeout after "+duration+"ms")})}},function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var EventTrackerWebservice=function(_super){function EventTrackerWebservice(events){var _this=_super.call(this)||this;return _this.events=events,_this}return __extends(EventTrackerWebservice,_super),EventTrackerWebservice.prototype.getQuery=function(){return{payload:this.events.map(function(e){return Object.assign({},e,{date:e.date.toISOString()})})}},EventTrackerWebservice.prototype.getURLShortname=function(){return"ev"},EventTrackerWebservice}(__importDefault(__webpack_require__(17)).default);exports.default=EventTrackerWebservice},function(module,exports,__webpack_require__){"use strict";var __assign=this&&this.__assign||Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t};Object.defineProperty(exports,"__esModule",{value:!0});var config_1=__webpack_require__(1),keys_profile_1=__webpack_require__(18),keys_system_1=__webpack_require__(19),DefaultHeaderKeys=[keys_profile_1.ProfileKeys.CustomIdentifier,keys_profile_1.ProfileKeys.UserRegion,keys_profile_1.ProfileKeys.UserLanguage,keys_profile_1.ProfileKeys.UserProfileVersion,keys_profile_1.ProfileKeys.InstallationID,keys_system_1.SystemKeys.SDKAPILevel,keys_system_1.SystemKeys.DeviceTimezone,keys_system_1.SystemKeys.DeviceTimezoneOffset,keys_system_1.SystemKeys.DeviceDate,keys_system_1.SystemKeys.DeviceLanguage],BaseURL=config_1.WS_URL+"/"+config_1.SDK_VERSION+"/",BaseWebservice=function(){function BaseWebservice(){}return BaseWebservice.prototype.getHeaders=function(parameterStore){return parameterStore.getParametersValues(DefaultHeaderKeys).then(function(parameters){return Object.keys(parameters).forEach(function(key){var value=parameters[key];null!=value&&(parameters[key]=""+value)}),parameters})},BaseWebservice.prototype.getBody=function(parameterStore){var _this=this;return this.getHeaders(parameterStore).then(function(h){return __assign({},_this.getQuery(),{ids:h})})},BaseWebservice.prototype.getBaseURL=function(){return BaseURL+this.getURLShortname()},BaseWebservice.prototype.getQuery=function(){throw new Error("BaseWebservice subclasses should override getQuery()")},BaseWebservice.prototype.getURLShortname=function(){throw new Error("BaseWebservice subclasses should override getURLShortname()")},BaseWebservice}();exports.default=BaseWebservice},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),function(ProfileKeys){ProfileKeys.InstallationID="di",ProfileKeys.CustomIdentifier="cus",ProfileKeys.UserRegion="ure",ProfileKeys.UserLanguage="ula",ProfileKeys.UserProfileVersion="upv",ProfileKeys.Subscription="subscription",ProfileKeys.Subscribed="subscribed",ProfileKeys.LastConfiguration="lastconfig"}(exports.ProfileKeys||(exports.ProfileKeys={}))},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),function(SystemKeys){SystemKeys.SDKAPILevel="lvl",SystemKeys.DeviceTimezone="dtz",SystemKeys.DeviceTimezoneOffset="dtzo",SystemKeys.DeviceDate="da",SystemKeys.DeviceLanguage="dla"}(exports.SystemKeys||(exports.SystemKeys={}))},function(module,exports,__webpack_require__){"use strict";var Browser,Platform;Object.defineProperty(exports,"__esModule",{value:!0}),function(Browser){Browser[Browser.Unknown=0]="Unknown",Browser[Browser.Generic=1]="Generic",Browser[Browser.Chrome=2]="Chrome",Browser[Browser.Firefox=3]="Firefox",Browser[Browser.Safari=4]="Safari"}(Browser=exports.Browser||(exports.Browser={})),function(Platform){Platform[Platform.Unknown=0]="Unknown",Platform[Platform.GenericDesktop=1]="GenericDesktop",Platform[Platform.GenericMobile=2]="GenericMobile",Platform[Platform.IOS=3]="IOS",Platform[Platform.Android=4]="Android",Platform[Platform.MacOS=5]="MacOS",Platform[Platform.Windows=6]="Windows",Platform[Platform.Linux=7]="Linux"}(Platform=exports.Platform||(exports.Platform={}));var UserAgent=function(){function UserAgent(userAgentString,platform){void 0===platform&&(platform=window.navigator.platform),this.rawUA=userAgentString,this.rawPlatform=platform,this.parse()}return UserAgent.prototype.uaContains=function(wanted){return-1!==this.rawUA.indexOf(wanted)},UserAgent.prototype.platformContains=function(wanted){return-1!==this.rawPlatform.indexOf(wanted)},UserAgent.prototype.isDesktop=function(){switch(this.platform){case Platform.GenericDesktop:case Platform.MacOS:case Platform.Windows:case Platform.Linux:return!0;default:return!1}},UserAgent.prototype.isMobile=function(){switch(this.platform){case Platform.GenericMobile:case Platform.IOS:case Platform.Android:return!0;default:return!1}},UserAgent.prototype.isVAPIDPotentiallySupported=function(){return(this.isDesktop()||this.platform===Platform.Android)&&(this.browser===Browser.Chrome||this.browser===Browser.Firefox)},UserAgent.prototype.parse=function(){if(this.browser=Browser.Unknown,this.uaContains("Edge/")||this.uaContains("Trident/"))return this.browser=Browser.Generic,void(this.platform=Platform.Windows);if(this.uaContains("iPhone")||this.uaContains("iPad")||this.uaContains("CriOS"))return this.browser=Browser.Generic,void(this.platform=Platform.IOS);if(this.uaContains("Android")?this.platform=Platform.Android:(this.uaContains("Mobi")||this.uaContains("Tablet"))&&(this.platform=Platform.GenericMobile),this.platform!==Platform.Android&&(this.platform=Platform.GenericDesktop),this.platform===Platform.GenericDesktop&&(this.platformContains("Mac")?this.platform=Platform.MacOS:this.platformContains("Win")?this.platform=Platform.Windows:(this.platformContains("Linux")||this.platformContains("X11"))&&(this.platform=Platform.Linux)),this.uaContains("Chrome/")||this.uaContains("Chromium/"))return this.browser=Browser.Chrome,void(this.platform===Platform.Android&&(this.uaContains("; wv")||this.uaContains("(wv;")||this.uaContains("Chrome/30.0.0.0")||this.uaContains("Chrome/33.0.0.0"))&&(this.browser=Browser.Generic));if(this.uaContains("Firefox/"))this.browser=Browser.Firefox;else if(this.uaContains("Version/")&&this.platform===Platform.Android)this.browser=Browser.Generic;else{if(this.uaContains("Safari/"))return this.browser=Browser.Safari,void(this.platform===Platform.GenericDesktop&&(this.platform=Platform.MacOS));this.browser=Browser.Unknown,this.platform===Platform.GenericDesktop&&(this.platform=Platform.Unknown)}},UserAgent}();exports.UserAgent=UserAgent,exports.default=UserAgent},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var keys_profile_1=__webpack_require__(18),keys_session_1=__webpack_require__(22),keys_system_1=__webpack_require__(19);function getValuesArrayForStringEnum(e){return Object.keys(e).map(function(key){return e[key]})}exports.allowedKeyByProvider={profile:getValuesArrayForStringEnum(keys_profile_1.ProfileKeys),session:getValuesArrayForStringEnum(keys_session_1.SessionKeys),system:getValuesArrayForStringEnum(keys_system_1.SystemKeys)},exports.keysByProvider={profile:keys_profile_1.ProfileKeys,session:keys_session_1.SessionKeys,system:keys_system_1.SystemKeys}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),function(SessionKeys){SessionKeys.SessionID="sessionId"}(exports.SessionKeys||(exports.SessionKeys={}))},function(module,exports,__webpack_require__){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var deep_obj_compare_1=__importDefault(__webpack_require__(8)),indexed_db_1=__importDefault(__webpack_require__(24)),session_1=__importDefault(__webpack_require__(26)),keys_1=__webpack_require__(21),profile_parameter_provider_1=__importDefault(__webpack_require__(27)),session_parameter_provider_1=__importDefault(__webpack_require__(28)),system_parameter_provider_1=__importDefault(__webpack_require__(29)),storeInstance=null,ParameterStore=function(){function ParameterStore(p){this.providers=p}return ParameterStore.prototype.getParameterValue=function(key){return-1!==keys_1.allowedKeyByProvider.system.indexOf(key)?this.providers.system.getParameterForKey(key):-1!==keys_1.allowedKeyByProvider.profile.indexOf(key)?this.providers.profile.getParameterForKey(key):-1!==keys_1.allowedKeyByProvider.session.indexOf(key)?this.providers.session.getParameterForKey(key):Promise.reject(key+" is not a managed key")},ParameterStore.prototype.setParameterValue=function(key,value){return-1!==keys_1.allowedKeyByProvider.profile.indexOf(key)?this.providers.profile.setParameterForKey(key,value):-1!==keys_1.allowedKeyByProvider.session.indexOf(key)?this.providers.session.setParameterForKey(key,value):Promise.reject(key+" is not a writtable key")},ParameterStore.prototype.setParameterValueIfChanged=function(key,value){var _this=this;return new Promise(function(resolve,reject){_this.getParameterValue(key).then(function(oldValue){deep_obj_compare_1.default(oldValue,value)?resolve(!1):_this.setParameterValue(key,value).then(function(){return resolve(!0)}).catch(reject)},function(error){reject(error)})})},ParameterStore.prototype.getParametersValues=function(keys){var _this=this,promises=keys.map(function(key){return _this.getParameterValue(key)});return Promise.all(promises).then(function(values){return values.reduce(function(acc,cur,indice){return acc[keys[indice]]=cur,acc},{})})},ParameterStore.getInstance=function(){return new Promise(function(resolve){storeInstance instanceof ParameterStore?resolve(storeInstance):indexed_db_1.default.getInstance().then(function(IndexedDb){storeInstance=new ParameterStore({profile:new profile_parameter_provider_1.default(IndexedDb),session:new session_parameter_provider_1.default(new session_1.default),system:new system_parameter_provider_1.default}),resolve(storeInstance)})})},ParameterStore}();exports.default=ParameterStore},function(module,exports,__webpack_require__){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var batch_error_1=__importDefault(__webpack_require__(25)),dbInstance=null,IndexedDbPersistence=function(){function IndexedDbPersistence(db){if(!(db instanceof IDBDatabase))throw new batch_error_1.default("Unable to setup indexed db");this.db=db}return IndexedDbPersistence.prototype.getData=function(key){var _this=this;return new Promise(function(resolve,reject){var query=_this.db.transaction(["BatchKVData"]).objectStore("BatchKVData").get(key);query.onerror=reject,query.onsuccess=function(event){var data=event.target.result;resolve(void 0===data?null:data.value)}})},IndexedDbPersistence.prototype.setData=function(key,value){var _this=this;return new Promise(function(resolve,reject){var query=_this.db.transaction(["BatchKVData"],"readwrite").objectStore("BatchKVData").put({k:key,value:value});query.onerror=reject,query.onsuccess=function(){return resolve(value)}})},IndexedDbPersistence.getInstance=function(){return new Promise(function(resolve,reject){if(dbInstance instanceof IndexedDbPersistence)resolve(dbInstance);else{indexedDB||reject(new Error("IndexedDB not available"));var request=indexedDB.open("BatchWebPush",1);request.onerror=function(err){reject(err)},request.onsuccess=function(event){var db=event.target.result;dbInstance=new IndexedDbPersistence(db),resolve(dbInstance)},request.onupgradeneeded=function(event){event.target.result.createObjectStore("BatchKVData",{keyPath:"k"})}}})},IndexedDbPersistence}();exports.default=IndexedDbPersistence},function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0});var BatchError=function(_super){function BatchError(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(BatchError,_super),BatchError}(Error);exports.default=BatchError},function(module,exports,__webpack_require__){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var safeWindow=__importDefault(__webpack_require__(4)).default(),Session=function(){function Session(){}return Session.prototype.getData=function(key){return null==safeWindow?Promise.reject("No session storage available"):new Promise(function(resolve){return resolve(safeWindow.sessionStorage.getItem(key))})},Session.prototype.setData=function(key,value){return null==safeWindow?Promise.reject("No session storage available"):new Promise(function(resolve){safeWindow.sessionStorage.setItem(key,value),resolve(value)})},Session}();exports.default=Session},function(module,exports,__webpack_require__){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var keys_1=__webpack_require__(21),batch_error_1=__importDefault(__webpack_require__(25)),ProfileParameterProvider=function(){function ProfileParameterProvider(storageProvider){this.storage=storageProvider}return ProfileParameterProvider.prototype.getParameterForKey=function(key){if(-1!==keys_1.allowedKeyByProvider.profile.indexOf(key))return this.storage.getData(key);throw new batch_error_1.default(key+" is not a managed profile key")},ProfileParameterProvider.prototype.setParameterForKey=function(key,value){if(-1!==keys_1.allowedKeyByProvider.profile.indexOf(key))return this.storage.setData(key,value);throw new batch_error_1.default(key+" is not a managed profile key")},ProfileParameterProvider}();exports.default=ProfileParameterProvider},function(module,exports,__webpack_require__){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var keys_1=__webpack_require__(21),batch_error_1=__importDefault(__webpack_require__(25)),SessionParameterProvider=function(){function SessionParameterProvider(storageProvider){this.storage=storageProvider}return SessionParameterProvider.prototype.getParameterForKey=function(key){if(-1!==keys_1.allowedKeyByProvider.session.indexOf(key))return this.storage.getData("com.batch."+key);throw new batch_error_1.default(key+" is not a managed session key")},SessionParameterProvider.prototype.setParameterForKey=function(key,value){if(-1!==keys_1.allowedKeyByProvider.session.indexOf(key))return this.storage.setData("com.batch."+key,value);throw new batch_error_1.default(key+" is not a managed session key")},SessionParameterProvider}();exports.default=SessionParameterProvider},function(module,exports,__webpack_require__){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var config_1=__webpack_require__(1),keys_system_1=__webpack_require__(19),batch_error_1=__importDefault(__webpack_require__(25)),window_1=__importDefault(__webpack_require__(4)),SystemParameterProvider=function(){function SystemParameterProvider(){}return SystemParameterProvider.prototype.getParameterForKey=function(key){return new Promise(function(resolve){switch(key){case keys_system_1.SystemKeys.SDKAPILevel:resolve(config_1.SDK_API_LVL);break;case keys_system_1.SystemKeys.DeviceTimezone:resolve(SystemParameterProvider.getTimezone());break;case keys_system_1.SystemKeys.DeviceTimezoneOffset:resolve((new Date).getTimezoneOffset().toString());break;case keys_system_1.SystemKeys.DeviceLanguage:var safeWindow=window_1.default();resolve(null!=safeWindow?safeWindow.navigator.language:"");break;case keys_system_1.SystemKeys.DeviceDate:resolve((new Date).toISOString());break;default:throw new batch_error_1.default(key+" is not a managed system key")}})},SystemParameterProvider.getTimezone=function(){if(self.Intl){var autoTZ=self.Intl.DateTimeFormat().resolvedOptions().timeZone;if(autoTZ)return autoTZ}return null},SystemParameterProvider}();exports.default=SystemParameterProvider},function(module,exports,__webpack_require__){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=this&&this.__generator||function(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=y[2&op[0]?"return":op[0]?"throw":"next"])&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[0,t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}};Object.defineProperty(exports,"__esModule",{value:!0});var logger_1=__webpack_require__(3),WebserviceExecutor=function(){function WebserviceExecutor(apiKey,subdomain,authKey,devMode,referrer,parameterStore){this.apiKey=apiKey,this.subdomain=subdomain,this.authKey=authKey,this.devMode=devMode,this.referrer=referrer,this.parameterStore=parameterStore}return WebserviceExecutor.prototype.start=function(ws){return __awaiter(this,void 0,void 0,function(){var options,body,URL_1,response,error_1;return __generator(this,function(_a){switch(_a.label){case 0:if("undefined"==typeof fetch)return[2,Promise.reject(new Error("fetch API isn't available"))];options={body:"",cache:"no-cache",credentials:"omit",headers:new Headers({Accept:"application/json","Content-Type":"application/json"}),method:"POST",mode:"cors"},this.devMode||"string"!=typeof this.authKey||options.headers.set("X-Batch-Auth",this.authKey),this.devMode&&options.headers.set("X-Batch-Dev","true"),this.referrer&&options.headers.set("X-Batch-Referer",this.referrer),_a.label=1;case 1:return _a.trys.push([1,4,,5]),[4,ws.getBody(this.parameterStore)];case 2:return body=_a.sent(),options.body=JSON.stringify(body),URL_1=ws.getBaseURL()+"/"+this.apiKey,logger_1.Log.grouped(logger_1.LogLevel.Info,"WSExecutor","Calling WS",["URL: "+URL_1,body,options]),[4,fetch(URL_1,options)];case 3:if(!(response=_a.sent()).ok)throw new Error('Response not ok. Status text: "'+response.statusText+'"');return logger_1.Log.grouped(logger_1.LogLevel.Info,"WSExecutor","WS finished successfuly",["Status text: "+response.statusText]),[2,!0];case 4:throw error_1=_a.sent(),logger_1.Log.error("WSExecutor","Error while executing WS",error_1),error_1;case 5:return[2]}})})},WebserviceExecutor}();exports.default=WebserviceExecutor},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),function(Permission){Permission.Default="default",Permission.Granted="granted",Permission.Denied="denied"}(exports.Permission||(exports.Permission={}))}]);